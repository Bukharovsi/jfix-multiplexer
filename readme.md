#Предназначение
Предназначение Multiplexer'а - в случае ограничения ширины исходящего канала буферезировать входящие сообщения 
из разных источнков и в порядке приоритета отсылать в обработчик.

#В каких случаях применяется
Если в преокте есть бутылочное горлышко, с ограниченным количеством одновременно обрабатываемых сообщений,
и в пиках это количество сообщений превышается. Мультиплексер позволит буферизировать входящие сообщения
и отправлять их по мере возможности. Так же поддерживается приоритет сообщений. Таким образом мультиплексер будет 
стараться балансировать отправку сообщений в соотвествии с приоритетом. 
Подробности [Wiki](https://portal.fix.ru/display/CPAPSM/Multiplexer)

#Как использовать
Прежде всего необходимо зарегистрировать все сообщения, которые будут проходить через мультиплексер.
```
Map<MessageType, Integer> priority = new LinkedHashMap<>();
priority.put(new MessageType("simple"), 100);
```
Зарегистрирован 1 тип вообщения с приоритетом 100.

Далее необходимо создать исходящий канал.

```
Function<String, CompletableFuture<String>> outputChannel =
        (msg) -> CompletableFuture.supplyAsync(() -> msg + " received");
```
Исходящий канал на выходе обязан отдавать CF<T>

Создаем инстанс мултиплексера
```
Multiplexer<String, String> multiplexer = new MultiplexerWithPriority<>(outputChannel, priority);
```

и теперь можно отправлять сообщения в канал через мультиплексер

```
CompletableFuture<MultiplexedMessageSendingResult<String>> promise
   = multiplexer.send("hello", new MessageType("simple"), 100L);
```

Примеры использования можно посмотреть в unit-тестах.